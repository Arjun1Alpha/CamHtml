<!doctype html>
<html lang="en">
  <head>
    <title>TRIBECA â€” Cloud Cards</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      @font-face {
        font-family: "fino-sans";
        src: url("./fino-sans-regular/Fino-Sans.otf") format("opentype");
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        font-family: "fino-sans", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
      }

      .project-strip {
        width: 100%;
        max-width: 1400px;
        padding: 6vh 4vw;
        display: flex;
        justify-content: center;
      }

      .project-strip-inner {
        display: flex;
        gap: clamp(1.75rem, 1.25rem + 2vw, 3rem);
        width: 100%;
        justify-content: center;
      }

      .project-card {
        flex: 1 1 0;
        max-width: 450px;
        aspect-ratio: 3.5 / 5;
        border-radius: 0;
        position: relative;
        /* overflow-y: hidden; */
        background: #1661b0; /* blue inside card, behind WebGL */
        box-shadow:
          0 24px 60px rgba(0, 0, 0, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.22);
      }

      .project-card-webgl {
        position: absolute;
        inset: 0;
        z-index: 0;
      }

      .project-card-media {
        position: absolute;
        inset: 0% 0% 0% 0%;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        z-index: 1;
        pointer-events: none;
      }

      .project-card-media img {
        /* max-width: 100%;
        max-height: 100%; */
        height: 700px;
        /* aspect-ratio: 3 / 5; */
        object-fit: contain;
        filter: drop-shadow(0 18px 40px rgba(0, 0, 0, 0.55));
        transform-origin: center bottom;
        transition:
          transform 0.9s cubic-bezier(0.22, 1, 0.36, 1),
          filter 0.9s cubic-bezier(0.22, 1, 0.36, 1);
      }

      .project-card:hover .project-card-media img {
        transform: translateY(-4px) scale(1.1);
        /* filter: drop-shadow(0 26px 60px rgba(0, 0, 0, 0.75)); */
      }

      .project-card-label {
        position: absolute;
        left: 11%;
        right: 11%;
        bottom: 6%;
        padding: 0.6rem 0.9rem;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.96);
        color: #4b4b54;
        font-size: clamp(0.78rem, 0.7rem + 0.35vw, 0.95rem);
        letter-spacing: 0.02em;
        text-align: center;
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.22);
        z-index: 2;
      }
    </style>
  </head>
  <body>
    <section class="project-strip" aria-label="Tribeca portfolio">
      <div class="project-strip-inner">
        <article class="project-card" data-cloud-offset="0">
          <div class="project-card-webgl"></div>
          <div class="project-card-media">
            <img src="./tower.png" alt="Trilive, Mumbai" />
          </div>
          <div class="project-card-label">Trilive, Mumbai</div>
        </article>

        <article class="project-card" data-cloud-offset="800">
          <div class="project-card-webgl"></div>
          <div class="project-card-media">
            <img src="./tower.png" alt="The Ark, Pune" />
          </div>
          <div class="project-card-label">The Ark, Pune</div>
        </article>

        <article class="project-card" data-cloud-offset="1600">
          <div class="project-card-webgl"></div>
          <div class="project-card-media">
            <img src="./tower.png" alt="Trump Towers, Gurgaon" />
          </div>
          <div class="project-card-label">Trump Towers, Gurgaon</div>
        </article>
      </div>
    </section>

    <!-- WebGL clouds inside each card -->
    <script src="js/three.min.js"></script>
    <script src="js/Detector.js"></script>

    <script id="vs" type="x-shader/x-vertex">
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      }
    </script>

    <script id="fs" type="x-shader/x-fragment">
      uniform sampler2D map;
      uniform vec3 fogColor;
      uniform float fogNear;
      uniform float fogFar;
      varying vec2 vUv;

      void main() {
        float depth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = smoothstep( fogNear, fogFar, depth );

        gl_FragColor = texture2D( map, vUv );
        float lum = dot( gl_FragColor.rgb, vec3( 0.599, 0.587, 0.114 ) );
        vec3 blueTint = vec3( 0.65, 0.82, 0.95 );
        gl_FragColor.rgb = gl_FragColor.rgb +
          ( 1.0 - lum ) * ( blueTint - gl_FragColor.rgb ) * 0.7;
        gl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
      }
    </script>

    <script>
      if (!Detector.webgl) {
        Detector.addGetWebGLMessage();
      }

      function createCloudInCard(card, offsetZ) {
        var host = card.querySelector(".project-card-webgl");
        var width = card.clientWidth;
        var height = card.clientHeight;

        var camera = new THREE.PerspectiveCamera(30, width / height, 1, 3000);
        camera.position.z = 800;

        var scene = new THREE.Scene();
        var geometry = new THREE.Geometry();

        var texture = THREE.ImageUtils.loadTexture(
          "cloud10.png",
          null,
          function () {
            animate();
          },
          function () {
            var el = document.createElement("div");
            el.style.cssText =
              "padding:0.75em;text-align:center;background:#eee;color:#000;font-family:monospace;font-size:11px;";
            el.textContent = "Cloud texture failed to load.";
            host.appendChild(el);
          }
        );
        texture.magFilter = THREE.LinearFilter;
        texture.minFilter = THREE.LinearMipMapLinearFilter;

        var fog = new THREE.Fog(0xa8d4e8, -100, 2000);

        var material = new THREE.ShaderMaterial({
          uniforms: {
            map: { type: "t", value: texture },
            fogColor: { type: "c", value: fog.color },
            fogNear: { type: "f", value: fog.near },
            fogFar: { type: "f", value: fog.far }
          },
          vertexShader: document.getElementById("vs").textContent,
          fragmentShader: document.getElementById("fs").textContent,
          depthWrite: false,
          depthTest: false,
          transparent: true
        });

        var plane = new THREE.Mesh(new THREE.PlaneGeometry(64, 64));
        var COUNT = 2500;

        for (var i = 0; i < COUNT; i++) {
          plane.position.x = Math.random() * 600 - 300;
          plane.position.y = -Math.random() * Math.random() * 260 - 10;
          plane.position.z = i;
          plane.rotation.z = Math.random() * Math.PI;
          plane.scale.x = plane.scale.y =
            Math.random() * Math.random() * 1.3 + 0.5;
          THREE.GeometryUtils.merge(geometry, plane);
        }

        var mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);

        mesh = new THREE.Mesh(geometry, material);
        mesh.position.z = -COUNT;
        scene.add(mesh);

        var renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
        renderer.setSize(width, height);
        host.appendChild(renderer.domElement);

        var cloudPosition = offsetZ || 0;
        var lastTime = Date.now();

        function onResize() {
          var w = card.clientWidth;
          var h = card.clientHeight;
          if (!w || !h) return;
          camera.aspect = w / h;
          camera.updateProjectionMatrix();
          renderer.setSize(w, h);
        }
        window.addEventListener("resize", onResize);

        function animate() {
          requestAnimationFrame(animate);
          var now = Date.now();
          var delta = now - lastTime;
          lastTime = now;

          cloudPosition += 0.02 * delta;
          cloudPosition = ((cloudPosition % COUNT) + COUNT) % COUNT;

          camera.position.z = -cloudPosition + 900;
          renderer.render(scene, camera);
        }
      }

      document.querySelectorAll(".project-card").forEach(function (card, i) {
        var offset = parseFloat(card.getAttribute("data-cloud-offset") || "0");
        createCloudInCard(card, offset);
      });
    </script>
  </body>
</html>